<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin=""/>
    <link rel="stylesheet" href="https://unpkg.com/persian-datepicker@latest/dist/css/persian-datepicker.css">
    <style>
        #map {
            height: 50vh;
        }
    </style>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

</head>
<body>
<form method="GET" action="{% url 'indexView' %}">
    <label for="start_date" class="form-label">تاریخ شروع:</label>
    <input type="text" id="start_date" class="str-date form-control" name="start_date"
            {% if start_date %}
           value="{{ start_date | safe }}"
            {% endif %}/>
    {#    <input type="date" id="start_date" class="form-control" name="start_date">#}
    <label for="end_date" class="form-label">تاریخ پایان:</label>
    <input type="text" id="end_date" class="end-date form-control" name="end_date"
            {% if end_date %}

           value="{{ end_date|safe }}"
            {% endif %}/>
    {#    <input type="date" id="end_date" class="form-control" name="end_date">#}
    <button type="submit" class="btn-success">Filter
    </button>
</form>

<div id="map"></div>
{% for item in all_item %}
    <canvas id={{ item }}></canvas>
{% endfor %}
</body>
<script src="https://code.jquery.com/jquery-3.7.1.js"></script>
<script src="https://unpkg.com/persian-date@latest/dist/persian-date.js"></script>
<script src="https://unpkg.com/persian-datepicker@latest/dist/js/persian-datepicker.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
        crossorigin=""></script>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Initialize the map
    var map = L.map('map').setView([34.790931, 48.487411], 13);

    // Add a tile layer to the map (OpenStreetMap)
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    // Define the data points
    var points = [
        {% for item in data %}
            {"lat": {{item.Lat}}, "lon": {{item.Lng}}, "data": "Point 1 Data"},

        {% endfor %}
        {"lat": 51.5, "lon": -0.09, "data": "Point 1 Data"},
        {"lat": 51.51, "lon": -0.1, "data": "Point 2 Data"},
        {"lat": 51.49, "lon": -0.08, "data": "Point 3 Data"}
    ];
    var circle = L.circle([34.790931, 48.487411], {
        color: 'red',
        fillColor: '#f03',
        fillOpacity: 0.5,
        radius: 600
    }).addTo(map)
    circle.bindPopup("دانشگاه بوعلی");

    // Add points to the map
    points.forEach(function (point) {
        var marker = L.marker([point.lat, point.lon]).addTo(map);
        marker.bindPopup(point.data);
    });
</script>
{% for att in all_item %}
    <script>
        const {{ att|safe }} = document.getElementById("{{ att }}");
        {#const ctx = document.getElementById('Humidity');#}

        new Chart({{att|safe}}, {
            type: 'bar',
            data: {
                labels: [{% for item in data %}"{{ item.created_at }}", {% endfor %}],
                datasets: [{
                    label: '{{ att|safe }}',
                    data: [{% for key,val in processed_data.items %}{% if key == att %}{% for i in val %}{{ i|safe }}, {% endfor %}{% endif %}{% endfor %}],
                    {#data: [{% for item in processed_data[att.attname] %}{{item}}, {% endfor %}],#}
                    borderWidth: 1
                }]
            },
            options: {
                layout: {
                    padding: 1
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        {#offset: true#}
                    },
                    x: {
                        offset: true,
                    }
                },
                responsive: true,
            },
        });
        {#console.log({{ start_date }})#}
    </script>
{% endfor %}
<script type="text/javascript">
    function persianToLatinNumbers(input) {
        const persianNumbers = ['۰', '۱', '۲', '۳', '۴', '۵', '۶', '۷', '۸', '۹'];
        const latinNumbers = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9'];

        let output = input;
        for (let i = 0; i < 10; i++) {
            const regex = new RegExp(persianNumbers[i], 'g');
            output = output.replace(regex, latinNumbers[i]);
        }
        return output;
    }

    $(document).ready(function () {
        $(".end-date").pDatepicker({
            {#inline: true,#}
            initialValueType: 'persian',
            initialValue: false,

            autoClose: true,
            format: "YYYY/MM/DD HH:MM",
            timePicker: {
                enabled: true,
                meridiem: {
                    enabled: true
                }
            },
            formatter: function (unixDate) {
                var date = new persianDate(unixDate);
                return persianToLatinNumbers(date.format('YYYY/MM/DD HH:mm'));
            },
            onSelect: function (unix) {
                from.touched = true;
                if (to && to.options && to.options.minDate != unix) {
                    var cachedValue = to.getState().selected.unixDate;
                    to.options = {minDate: unix};
                    if (to.touched) {
                        to.setDate(cachedValue);
                    }
                }
            }

        });
        $(".str-date").pDatepicker({
            initialValueType: 'persian',
            initialValue: false,
            onSelect: function (unix) {
                to.touched = true;
                if (from && from.options && from.options.maxDate != unix) {
                    var cachedValue = from.getState().selected.unixDate;
                    from.options = {maxDate: unix};
                    if (from.touched) {
                        from.setDate(cachedValue);
                    }
                }
            },
            formatter: function (unixDate) {
                var date = new persianDate(unixDate);
                return persianToLatinNumbers(date.format('YYYY/MM/DD HH:mm'));
            },
            autoClose: true,
            format: "YYYY/MM/DD HH:MM",
            timePicker: {
                enabled: true,
                meridiem: {
                    enabled: true
                }
            },
        });
    });
</script>

<input type="text" class="example1"/>

<script src="https://maps.googleapis.com/maps/api/js?key=YOUR_KEY&callback=myMap"></script>

</html>